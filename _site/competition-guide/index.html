<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>SciBench</title>
<meta name="description" content="Scientist-in-the-loop benchmark for symbolic regression">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="SciBench">
<meta property="og:title" content="SciBench">
<meta property="og:url" content="http://localhost:4000/competition-guide/">


  <meta property="og:description" content="Scientist-in-the-loop benchmark for symbolic regression">












<link rel="canonical" href="http://localhost:4000/competition-guide/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<!-- [WGL] used https://gauger.io/fonticon/ -->
<link rel="shortcut icon" href="/assets/images/favicon.ico">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          SciBench
          <span class="site-subtitle">Scientist-in-the-loop benchmark for symbolic regression</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">SciBench</a>
            </li><li class="masthead__menu-item">
              <a href="/user-guide">User Guide</a>
            </li><li class="masthead__menu-item">
              <a href="/contributing/">Contributing</a>
            </li><li class="masthead__menu-item">
              <a href="/results/">Results</a>
            </li><li class="masthead__menu-item">
              <a href="/datasets/">Datasets</a>
            </li><li class="masthead__menu-item">
              <a href="/competition-2022/">Competition 2022</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Maintained by <a href="https://github.com/jiangnanhugo">@jiangnanhugo</a> and many open-source contributors</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://github.com/jiangnanhugo/scibench/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub Repo</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
      
      
      
      
    
    
      

<nav class="nav__list">
  <h3 class="nav__title" style="padding-left: 0;">Competition 2022</h3>
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/competition-2022/"><span class="nav__sub-title">Results</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/competition-guide/"><span class="nav__sub-title">Competition Guide</span></a>
        

        
        <ul>
          
            <li><a href="/competition-guide/#instructions">Instructions</a></li>
          
            <li><a href="/competition-guide/#regressor-guide">Regressor Guide</a></li>
          
            <li><a href="/competition-guide/#competition-details">Competition Details</a></li>
          
            <li><a href="/judging-criteria/">Judging Criteria</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#srbench-2022-competition-guidelines">SRBench 2022 Competition Guidelines</a><ul><li><a href="#instructions">Instructions</a><ul><li><a href="#version-control">Version control</a></li></ul></li><li><a href="#regressor-guide">Regressor Guide</a><ul><li><a href="#returning-a-sympy-compatible-model-string">Returning a sympy compatible model string</a></li><li><a href="#cli-methods">CLI methods</a></li></ul></li><li><a href="#competition-details">Competition Details</a><ul><li><a href="#stages">Stages</a></li><li><a href="#judging-criteria">Judging Criteria</a></li><li><a href="#computing-environment">Computing Environment</a></li><li><a href="#time-budget">Time Budget</a><ul><li><a href="#timeout-handling">Timeout Handling</a></li></ul></li><li><a href="#hyperparameter-tuning">Hyperparameter Tuning</a></li></ul></li></ul></li></ul>

            </nav>
          </aside>
        
        
<div class="notice">
  <h1>2022 SRBench Competition</h1>
  <p>This competition is now closed.</p>
</div>

<hr />

<h1 id="srbench-2022-competition-guidelines">SRBench 2022 Competition Guidelines</h1>
<p>To participate, the steps are relatively straightforward. 
Participants fork this repo, checkout the <a href="https://github.com/cavalab/srbench/tree/Competition2022">Competition2022 branch</a>, add a method in the submission folder (see <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/">submission/feat-example</a>), and submit it as a <a href="https://github.com/cavalab/srbench/compare/Competition2022...change-to-my-fork">pull request</a> to the <a href="https://github.com/cavalab/srbench/tree/Competition2022">Competition2022 branch</a>. 
Once submitted, the continuous integration process will give feedback if there are any problems with the submission. 
Participants can then update their PR as necessary to have it pass the tests.</p>

<p>Once everything is working, participants can basically sit tight: the competition organizers will then set about testing the methods on a variey of datasets.</p>

<h2 id="instructions">Instructions</h2>

<ol>
  <li>
    <p>Fork this repository and clone it. Check out the <a href="https://github.com/cavalab/srbench/tree/Competition2022">Competition2022 branch</a>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> git clone git@github.com:your-name/srbench
 <span class="nb">cd </span>srbench
 git checkout Competition2022 <span class="c"># may need to "git fetch" first if this fails</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make a folder in the <code class="language-plaintext highlighter-rouge">submission/</code> named after your method. You can start with a template by copying the <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/"><code class="language-plaintext highlighter-rouge">submission/feat-example</code></a> folder, renaming and editing it.</p>
  </li>
  <li>
    <p>In the folder, put the contents of your submission. This folder should contain:</p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">metadata.yml</code> (<strong>required</strong>): A file describing your submission, following the descriptions in <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/metadata.yml">submission/feat-example/metadata.yml</a>.</li>
      <li><code class="language-plaintext highlighter-rouge">regressor.py</code> (<strong>required</strong>): a Python file that defines your method, named appropriately. See <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/regressor.py">submission/feat-example/regressor.py</a> for complete documentation. 
 It should contain:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">est</code>: a sklearn-compatible <code class="language-plaintext highlighter-rouge">Regressor</code> object.</li>
          <li><code class="language-plaintext highlighter-rouge">model(est, X=None)</code>: a function that returns a <a href="https://www.sympy.org"><strong>sympy-compatible</strong></a> string specifying the final model. It can optionally take the training data as an input argument. See <a href="###-returning-a-sympy-compatible-model-string">guidance below</a>.</li>
          <li><code class="language-plaintext highlighter-rouge">eval_kwargs</code> (optional): a dictionary that can specify method-specific arguments to <code class="language-plaintext highlighter-rouge">evaluate_model.py</code>.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">LICENSE</code> <em>(optional)</em> A license file</li>
      <li><code class="language-plaintext highlighter-rouge">environment.yml</code> <em>(optional)</em>: a <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file">conda environment file</a> that specifies dependencies for your submission. 
 See <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/environment.yml">submission/feat-example/environment.yml</a> for an example.
 It will be used to update the baseline environment (<code class="language-plaintext highlighter-rouge">environment.yml</code> in the root directory). 
 To the extent possible, conda should be used to specify the dependencies you need. 
 If your method is part of conda, great! You can just put that in here and leave <code class="language-plaintext highlighter-rouge">install.sh</code> blank.</li>
      <li><code class="language-plaintext highlighter-rouge">install.sh</code> <em>(optional)</em>: a bash script that installs your method. 
 **Note: scripts should not require sudo permissions. The library and include paths should be directed to conda environment; the environmental variable <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX</code> specifies the path to the environment.</li>
      <li>
        <p>additional files <em>(optional)</em>: you may include a folder containing the code for your method in the submission. Otherwise, <code class="language-plaintext highlighter-rouge">install.sh</code> should pull the source code remotely.</p>
      </li>
      <li>
        <p>Commit your changes and submit your branch as a <a href="https://github.com/cavalab/srbench/compare/Competition2022...change-to-my-fork">pull request Competition 2022 branch</a>.</p>
      </li>
      <li>Once the tests pass, you will be an official competitor!</li>
    </ol>
  </li>
</ol>

<h3 id="version-control">Version control</h3>

<p>The install process should guarantee that the version for your algorithm that gets installed is <strong>fixed</strong>. 
You can do this in many ways:</p>

<ol>
  <li>Including the source code with the submission.</li>
  <li>Pulling a tagged version/release of your code from a git repository.</li>
  <li>Checking out a specific commit, as in the provided example.</li>
</ol>

<h2 id="regressor-guide">Regressor Guide</h2>

<p>For detailed documentation, carefully read the example <code class="language-plaintext highlighter-rouge">regressor.py</code> file in <a href="https://github.com/cavalab/srbench/blob/Competition2022/submission/feat-example/regressor.py">submission/feat-example/regressor.py</a>, which describes several options for configuring your algorithm.</p>

<h3 id="returning-a-sympy-compatible-model-string">Returning a sympy compatible model string</h3>

<p>In order to check for exact solutions to problems with known, ground-truth models, each SR method returns a model string that can be manipulated in <a href="https://www.sympy.org">sympy</a>. 
Assure the returned model meets these requirements:</p>

<ol>
  <li>The variable names appearing in the model are identical to those in the training data, <code class="language-plaintext highlighter-rouge">X</code>, which is a <code class="language-plaintext highlighter-rouge">pd.Dataframe</code>. 
If your method names variables some other way, e.g. <code class="language-plaintext highlighter-rouge">[x_0 ... x_m]</code>, you can
specify a mapping in the <code class="language-plaintext highlighter-rouge">model</code> function such as:</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">'x_'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">k</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X</span><span class="p">.</span><span class="n">columns</span><span class="p">)}</span>
    <span class="n">new_model</span> <span class="o">=</span> <span class="n">est</span><span class="p">.</span><span class="n">model_</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mapping</span><span class="p">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">new_model</span> <span class="o">=</span> <span class="n">new_model</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>The operators/functions in the model are available in <a href="https://docs.sympy.org/latest/modules/functions/index.html">sympy’s function set</a>.</li>
</ol>

<p><strong>Note:</strong> In part of the competition (see the <a href="https://cavalab.org/srbench/judging-criteria/">judging criteria</a>), models will be checked for symbolic equivalence with ground-truth formulae. 
If your method uses protected operators (e.g., <code class="language-plaintext highlighter-rouge">my_prot_div(a,b)= a/b if b!=0 else 1</code> or <code class="language-plaintext highlighter-rouge">my_prot_log(a)=log(abs(a)+eps)</code>), replace these with non-protected (sympy-compatible) versions when calling <code class="language-plaintext highlighter-rouge">model</code>. For example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="p">...</span> <span class="c1"># any previous pre-processing
</span>    <span class="n">new_model</span> <span class="o">=</span> <span class="n">new_model</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"my_prot_div"</span><span class="p">,</span><span class="s">"/"</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"my_prot_log"</span><span class="p">,</span><span class="s">"log"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="cli-methods">CLI methods</h3>

<p>Is your SR method typically called via a command line interface? 
Check out this <a href="https://gist.github.com/folivetti/609bc9b854c51968ef90aa675ccaa60d">gist</a> to make a sklearn interface.</p>

<h2 id="competition-details">Competition Details</h2>

<p>Once a method is successfully added to the Competition2022 branch, the organizing team will set about running each participant’s method through a set of datasets. 
These datasets include synthetic and real-world tasks. 
Each dataset will have less than 10,000 samples and fewer than 100 features.</p>

<h3 id="stages">Stages</h3>

<p>The competition consists of three stages, summarized in the table below.</p>

<table>
  <thead>
    <tr>
      <th>Stage</th>
      <th>Qualification</th>
      <th>Synthetic</th>
      <th>Real-World</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Benchmark Data</td>
      <td>PMLB-20</td>
      <td>Synthetic</td>
      <td>Real-World</td>
    </tr>
    <tr>
      <td>Criteria</td>
      <td>Better than linear regresion</td>
      <td>Accuracy, Simplicity, Exact Solutions</td>
      <td>Accuracy, Simplicity, Expert Assessment</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>The first stage is a simple filter: submitted methods must be better than a linear model on PMLB-20. 
PMLB-20 is a set of 20 datasets we will select from the <a href="https://github.com/EpistasisLab/pmlb">Penn Machine Learning Benchmark</a> used in our <a href="https://scikit-learn.org/stable/modules/classes.html#hyper-parameter-optimizers">original SRBench analysis</a>. (Participants are free to tune on this benchmark.)</li>
  <li>The second and third stages are separate and independent tracks (a method can, in principle, win both): the <em>Synthetic</em> track and the <em>Real-World</em> track.
The judging criteria for these tracks are different but share some aspects.
For example, common judging criteria are accuracy (in terms of <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html?highlight=r2_score#sklearn.metrics.r2_score">R2 Score</a>) and simplicity (in terms of number of model components).</li>
</ul>

<h3 id="judging-criteria">Judging Criteria</h3>

<p>Full details on the judging criteria can be found <a href="https://cavalab.org/srbench/judging-criteria/">here</a>.</p>

<h3 id="computing-environment">Computing Environment</h3>

<p>Experiments will be run in a heterogeneous cluster computing environment composed of several hosts with 24-28 core Intel(R) Xeon(R) CPU E5-2690 v4 @ 2.60GHz processors and 250 GB of RAM.</p>

<p>The cluster uses an LSF scheduler. 
We define a <em>job</em> as the training of an algorithm on a single dataset. 
For each job, an algorithm will have access to the following resources:</p>

<table>
  <thead>
    <tr>
      <th>Benchmark</th>
      <th style="text-align: right">PMLB-20</th>
      <th style="text-align: right">Synthetic</th>
      <th style="text-align: right">Real-World</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RAM</td>
      <td style="text-align: right">16 GB</td>
      <td style="text-align: right">16 GB</td>
      <td style="text-align: right">16 GB</td>
    </tr>
    <tr>
      <td>CPU Cores</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
    </tr>
  </tbody>
</table>

<p>CPU cores for each job will span a single host, so methods are encouraged to support CPU-level parallelism. 
The number of CPU cores can be determined via the environment variable <strong>OMP_NUM_THREADS</strong>. 
In python, one can grab this value as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">n_cpus</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'OMP_NUM_THREADS'</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="time-budget">Time Budget</h3>

<p>Methods must adhere to a fixed time budget for the competition. 
<em>These time budgets are designed to be <strong>generous</strong>, not <strong>restrictive</strong></em>. 
Our goal is to allow “slow” implementations enough time to learn.</p>

<p>All datasets will be less than 10,000 rows and fewer than 100 features. 
The time limits are as follows:</p>

<ul>
  <li>For datasets up to 1000 rows, 60 minutes (1 hour)</li>
  <li>For datasets up to 10000 rows, 600 minutes (10 hours)</li>
</ul>

<p>If a call to <code class="language-plaintext highlighter-rouge">est.fit()</code> takes longer than the allotted time, <code class="language-plaintext highlighter-rouge">est.fit()</code> will receive a <code class="language-plaintext highlighter-rouge">SIGALRM</code> and the evaluation routine will raise a <code class="language-plaintext highlighter-rouge">TimeOutException</code>. 
Shortly thereafter (on the order of seconds), the job will be killed.</p>

<p><strong>The preferred approach is that participants design their algorithms to terminate comfortably in less than an hour for 1000x100 datasets, and less than 10 hours for 10000x100 datasets.</strong>
Participants are also encouraged to include a <code class="language-plaintext highlighter-rouge">max_time</code> parameter and set it appropriately.</p>

<p>To define dataset-specific runtime parameters, users can define a <code class="language-plaintext highlighter-rouge">pre_train()</code>
function in <code class="language-plaintext highlighter-rouge">regressor.py</code> as part of <code class="language-plaintext highlighter-rouge">eval_kwargs</code>. 
As an example, one could define the following in <code class="language-plaintext highlighter-rouge">regressor.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pre_train_fn</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> 
    <span class="s">"""set max_time in seconds based on length of X."""</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">:</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># 1 second of slack
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># 1 second of slack
</span>    <span class="n">est</span><span class="p">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">max_time</span><span class="p">)</span>

<span class="c1"># pass the function to eval_kwargs
</span><span class="n">eval_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'pre_train'</span><span class="p">:</span> <span class="n">pre_train_fn</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="timeout-handling">Timeout Handling</h4>

<p>Instead of managing runtime internally, participants may choose to handle the <code class="language-plaintext highlighter-rouge">SIGALRM</code> signal or the <code class="language-plaintext highlighter-rouge">TimeOutException</code> sent from the evaluation routine.
However, <em>proceed with caution</em>: the exception handling runs the risk of taking an unexpected amount of time and leading to the job being killed. 
Nonetheless, timeout handling looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">signal</span>

<span class="k">class</span> <span class="nc">TimeOutException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">alarm_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"raising TimeOutException"</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">TimeOutException</span>

<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">est</span><span class="p">):</span>
    <span class="s">"""model evaluation"""</span>
    <span class="c1"># alarm that sends SIGALRM
</span>    <span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">alarm_handler</span><span class="p">)</span>
    <span class="n">signal</span><span class="p">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">MAXTIME</span><span class="p">)</span> <span class="c1"># maximum time, defined above 
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">est</span><span class="p">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">TimeOutException</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'evaluate timeout'</span><span class="p">)</span>
</code></pre></div></div>

<p>Example approaches are the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HandleExceptionAlg</code> handles the <code class="language-plaintext highlighter-rouge">TimeOutException</code>:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># submission codebase
</span>
<span class="k">class</span> <span class="nc">HandleExceptionAlg</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">'initial value'</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># model training
</span>        <span class="k">except</span> <span class="n">TimeOutException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'TimeOutException raised'</span><span class="p">)</span>
            <span class="c1"># gracefully and quickly choose final model
</span>            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HandleSignalExceptionAlg</code> handles the <code class="language-plaintext highlighter-rouge">SIGALRM</code> with its own internal exception. This is potentially useful for methods that call external routines that can handle <code class="language-plaintext highlighter-rouge">SIGALRM</code>.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># submission codebase
</span>
<span class="k">class</span> <span class="nc">InternalTimeOutException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">HandleSignalExceptionAlg</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">'initial value'</span>

    <span class="k">def</span> <span class="nf">alarm_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"raising InternalTimeOutException"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InternalTimeOutException</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># define an internal signal handler
</span>        <span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">alarm_handler</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># model training
</span>        <span class="k">except</span> <span class="n">InternalTimeOutException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'InternalTimeOutException raised'</span><span class="p">)</span>
            <span class="c1"># gracefully terminate 
</span>            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></div>

<p><a href="https://gist.github.com/lacava/77b19f2b032413ed1b5cee697b969149">This gist</a> gives examples of timeout handling. 
These examples are for illustration purposes only and should be independently verified for compatibility with user’s code submissions.</p>

<h3 id="hyperparameter-tuning">Hyperparameter Tuning</h3>

<p class="notice--warning"><strong>Warning</strong> If choose to conduct hyperparameter tuning, this counts towards the time limit. 
In the example below we show one way to set the <code class="language-plaintext highlighter-rouge">max_time</code> accordingly.</p>

<p>Unlike our <a href="https://datasets-benchmarks-proceedings.neurips.cc/paper/2021/hash/c0c7c76d30bd3dcaefc96f40275bdc0a-Abstract-round1.html">prior study</a>, the competition does not automatically conduct hyper-parameter tuning for each method. 
Thus, it is up to participants to decide whether they want to include hyperparameter tuning as part of algorithm training in <code class="language-plaintext highlighter-rouge">regressor.py</code>. 
Here is an example of how to do so:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="c1">#from mylibrary import MyMethod
</span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>


<span class="n">hyper_params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'alpha'</span><span class="p">:</span> <span class="p">(</span><span class="mf">1e-04</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,)</span> <span class="p">}</span>

<span class="c1"># define your base estimator
</span><span class="n">base_est</span><span class="o">=</span><span class="n">linear_model</span><span class="p">.</span><span class="n">LassoLars</span><span class="p">()</span>

<span class="c1"># set est to be a GridSearchCV estimator
</span><span class="n">est</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">base_est</span><span class="p">,</span> 
                   <span class="n">param_grid</span><span class="o">=</span><span class="n">hyper_params</span><span class="p">,</span> 
                   <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                   <span class="n">refit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># set max time w.r.t. hyper-param tuning
</span><span class="n">num_combos</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># five values of alpha
</span><span class="n">num_cv</span> <span class="o">=</span> <span class="mi">5</span>      <span class="c1"># 5 cross-validation splits as above
</span><span class="n">total_runs</span> <span class="o">=</span> <span class="n">num_combos</span> <span class="o">*</span> <span class="n">num_cv</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># +1 because refit=True
</span>
<span class="k">def</span> <span class="nf">pre_train_fn</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> 
    <span class="s">"""set max_time in seconds based on length of X &amp; hyper-parameter tuning"""</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1000</span><span class="p">:</span>
        <span class="c1"># account for hyper-parameter tuning, remove 1 extra second of slack to be sure it will terminate on time
</span>        <span class="n">max_time</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">//</span> <span class="n">total_runs</span> <span class="o">-</span> <span class="mi">1</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="mi">3600</span> <span class="o">//</span> <span class="n">total_runs</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">est</span><span class="p">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">max_time</span><span class="p">)</span>

<span class="c1"># pass the function eval_kwargs
</span><span class="n">eval_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'pre_train'</span><span class="p">:</span> <span class="n">pre_train_fn</span>
<span class="p">}</span>

<span class="c1"># additional definitions
# ...
</span></code></pre></div></div>

<p>In this example, the estimator is a GridSearchCV object wrapping a method (here a LassoLars model). 
During fit, it will tune the <code class="language-plaintext highlighter-rouge">alpha</code> parameter using cross-validation. 
Moreover, the <code class="language-plaintext highlighter-rouge">pre_train_fn</code> is set to run the method so that the time limit will not be exceeded.
For hyper-parameter optimizers other than GridSearchCV, see, e.g., the <a href="https://scikit-learn.org/stable/modules/classes.html#hyper-parameter-optimizers">scikit-learn docs</a>.</p>


        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/jiangnanhugo/scibench/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 SciBench. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
